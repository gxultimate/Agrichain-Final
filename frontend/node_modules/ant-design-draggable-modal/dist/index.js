"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),reactUid=require("react-uid"),antd=require("antd"),__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&(n[i[a]]=e[i[a]])}return n}var DraggableModalContext=React.createContext(null),ResizeHandle=function(e){return React.createElement("div",__assign({className:"ant-design-draggable-modal-resize-handle"},e),React.createElement("div",{className:"ant-design-draggable-modal-resize-handle-inner"}))},useDrag=function(e,t,n){var i=React.useState(!1),a=i[0],r=i[1],o=React.useState({initX:0,initY:0,mouseDownX:0,mouseDownY:0}),d=o[0],s=o[1],l=React.useCallback(function(n){n.preventDefault(),s({initX:e,initY:t,mouseDownX:n.clientX,mouseDownY:n.clientY}),r(!0)},[e,t,r,s]);return React.useEffect(function(){var e=function(e){if(a){var t=d.initX,i=d.mouseDownX,r=d.initY,o=d.mouseDownY,s=e.clientX-i,l=e.clientY-o;n({x:t+s,y:r+l})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[d,a,n]),React.useEffect(function(){var e=function(){r(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[r]),l},usePrevious=function(e){var t=React.useRef(null);return React.useEffect(function(){t.current=e}),t.current},useResize=function(e,t,n,i,a){var r=React.useState(!1),o=r[0],d=r[1],s=React.useState({initX:0,initY:0,initWidth:0,initHeight:0,mouseDownX:0,mouseDownY:0}),l=s[0],u=s[1],c=React.useCallback(function(a){a.preventDefault(),u({initX:e,initY:t,initWidth:n,initHeight:i,mouseDownX:a.clientX,mouseDownY:a.clientY}),d(!0)},[n,i,d,u,e,t]);return React.useEffect(function(){var e=function(e){if(o){var t=l.initX,n=l.initY,i=l.initWidth,r=l.mouseDownX,d=l.initHeight,s=l.mouseDownY,u=e.clientX-r,c=e.clientY-s;return a({x:t,y:n,width:i+u,height:d+c})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[l,o,a]),React.useEffect(function(){var e=function(){d(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[d]),c},modalStyle={margin:0,paddingBottom:0,pointerEvents:"auto"},DraggableModalInner=React.memo(function(e){var t=e.id,n=e.modalState,i=e.dispatch,a=e.visible,r=e.children,o=e.title,d=__rest(e,["id","modalState","dispatch","visible","children","title"]);React.useEffect(function(){return i({type:"mount",id:t}),function(){return i({type:"unmount",id:t})}},[i,t]);var s=usePrevious(a);React.useEffect(function(){a!==s&&i(a?{type:"show",id:t}:{type:"hide",id:t})},[a,s,t,i]);var l=n.zIndex,u=n.x,c=n.y,g=n.width,m=n.height,w=React.useMemo(function(){return __assign({},modalStyle,{top:c,left:u,height:m})},[c,u,m]),h=React.useCallback(function(){return i({type:"focus",id:t})},[t,i]),f=React.useCallback(function(e){return i(__assign({type:"drag",id:t},e))},[i,t]),v=React.useCallback(function(e){return i(__assign({type:"resize",id:t},e))},[i,t]),x=useDrag(u,c,f),_=useResize(u,c,g,m,v),p=React.useMemo(function(){return React.createElement("div",{className:"ant-design-draggable-modal-title",onMouseDown:x,onClick:h},o)},[x,h,o]);return React.createElement(antd.Modal,__assign({wrapClassName:"ant-design-draggable-modal",style:w,width:g,destroyOnClose:!0,mask:!1,maskClosable:!1,zIndex:l,title:p,visible:a},d),r,React.createElement(ResizeHandle,{onMouseDown:_}))});DraggableModalInner.displayName="DraggableModalInner";var getWindowSize=function(){return{width:window.innerWidth||0,height:window.innerHeight||0}},clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},mapObject=function(e,t){return Object.assign.apply(Object,[{}].concat(Object.keys(e).map(function(n){var i;return(i={})[n]=t(e[n]),i})))},initialModalsState={maxZIndex:0,windowSize:getWindowSize(),modals:{}},initialModalState={x:0,y:0,width:800,height:800,zIndex:0,visible:!1},getModalState=function(e,t){return e.modals[t]||initialModalState},getNextZIndex=function(e,t){return getModalState(e,t).zIndex===e.maxZIndex?e.maxZIndex:e.maxZIndex+1},clampDrag=function(e,t,n,i,a,r){var o=t-r;return{x:clamp(0,e-a,n),y:clamp(0,o,i)}},clampResize=function(e,t,n,i,a,r){var o=t-i;return{width:clamp(200,e-n,a),height:clamp(200,o,r)}},draggableModalReducer=function(e,t){var n,i,a,r,o,d;switch(t.type){case"resize":var s=clampResize(e.windowSize.width,e.windowSize.height,t.x,t.y,t.width,t.height);return __assign({},e,{maxZIndex:getNextZIndex(e,t.id),modals:__assign({},e.modals,(n={},n[t.id]=__assign({},e.modals[t.id],s,{zIndex:getNextZIndex(e,t.id)}),n))});case"drag":return __assign({},e,{maxZIndex:getNextZIndex(e,t.id),modals:__assign({},e.modals,(i={},i[t.id]=__assign({},e.modals[t.id],clampDrag(e.windowSize.width,e.windowSize.height,t.x,t.y,e.modals[t.id].width,e.modals[t.id].height),{zIndex:getNextZIndex(e,t.id)}),i))});case"show":var l=e.modals[t.id],u=e.windowSize.width/2-l.width/2,c=e.windowSize.height/2-l.height/2,g=clampDrag(e.windowSize.width,e.windowSize.height,u,c,l.width,l.height),m=clampResize(e.windowSize.width,e.windowSize.height,g.x,g.y,l.width,l.height);return __assign({},e,{maxZIndex:e.maxZIndex+1,modals:__assign({},e.modals,(a={},a[t.id]=__assign({},l,g,m,{zIndex:e.maxZIndex+1,visible:!0}),a))});case"focus":var w=e.modals[t.id];return __assign({},e,{maxZIndex:e.maxZIndex+1,modals:__assign({},e.modals,(r={},r[t.id]=__assign({},w,{zIndex:e.maxZIndex+1}),r))});case"hide":var h=e.modals[t.id];return __assign({},e,{modals:__assign({},e.modals,(o={},o[t.id]=__assign({},h,{visible:!1}),o))});case"mount":return __assign({},e,{maxZIndex:e.maxZIndex+1,modals:__assign({},e.modals,(d={},d[t.id]=__assign({},initialModalState,{x:e.windowSize.width/2-initialModalState.width/2,y:e.windowSize.height/2-initialModalState.height/2,zIndex:e.maxZIndex+1}),d))});case"unmount":var f=__assign({},e.modals);return delete f[t.id],__assign({},e,{modals:f});case"windowResize":return __assign({},e,{windowSize:t.size,modals:mapObject(e.modals,function(t){if(!t.visible)return t;var n=clampDrag(e.windowSize.width,e.windowSize.height,t.x,t.y,t.width,t.height),i=clampResize(e.windowSize.width,e.windowSize.height,n.x,n.y,t.width,t.height);return __assign({},t,n,i)})});default:throw new Error}},DraggableModal=function(e){var t=reactUid.useUID(),n=React.useContext(DraggableModalContext);if(!n)throw new Error("No Provider");var i=n.dispatch,a=n.state,r=getModalState(a,t);return React.createElement(DraggableModalInner,__assign({id:t,dispatch:i,modalState:r},e))},DraggableModalProvider=function(e){var t=e.children,n=React.useReducer(draggableModalReducer,initialModalsState),i=n[0],a=n[1];return React.useEffect(function(){if("object"==typeof window){var e=function(){return a({type:"windowResize",size:getWindowSize()})};return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}},[a]),React.createElement(DraggableModalContext.Provider,{value:{state:i,dispatch:a}},t)};exports.DraggableModal=DraggableModal,exports.DraggableModalContext=DraggableModalContext,exports.DraggableModalProvider=DraggableModalProvider;
//# sourceMappingURL=index.js.map
