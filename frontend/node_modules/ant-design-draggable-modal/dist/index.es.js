import{createContext as e,createElement as n,useState as i,useCallback as t,useEffect as o,useRef as r,memo as d,useMemo as a,useContext as u,useReducer as s}from"react";import{useUID as w}from"react-uid";import{Modal as m}from"antd";var h=function(){return(h=Object.assign||function(e){for(var n,i=1,t=arguments.length;i<t;i++)for(var o in n=arguments[i])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};var l=e(null),c=function(e){return n("div",h({className:"ant-design-draggable-modal-resize-handle"},e),n("div",{className:"ant-design-draggable-modal-resize-handle-inner"}))},v={margin:0,paddingBottom:0,pointerEvents:"auto"},f=d(function(e){var d=e.id,u=e.modalState,s=e.dispatch,w=e.visible,l=e.children,f=e.title,x=function(e,n){var i={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(i[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&(i[t[o]]=e[t[o]])}return i}(e,["id","modalState","dispatch","visible","children","title"]);o(function(){return s({type:"mount",id:d}),function(){return s({type:"unmount",id:d})}},[s,d]);var g,p,z=(g=w,p=r(null),o(function(){p.current=g}),p.current);o(function(){w!==z&&s(w?{type:"show",id:d}:{type:"hide",id:d})},[w,z,d,s]);var y=u.zIndex,I=u.x,b=u.y,S=u.width,D=u.height,X=a(function(){return h({},v,{top:b,left:I,height:D})},[b,I,D]),Y=t(function(){return s({type:"focus",id:d})},[d,s]),O=t(function(e){return s(h({type:"drag",id:d},e))},[s,d]),Z=t(function(e){return s(h({type:"resize",id:d},e))},[s,d]),E=function(e,n,r){var d=i(!1),a=d[0],u=d[1],s=i({initX:0,initY:0,mouseDownX:0,mouseDownY:0}),w=s[0],m=s[1],h=t(function(i){i.preventDefault(),m({initX:e,initY:n,mouseDownX:i.clientX,mouseDownY:i.clientY}),u(!0)},[e,n,u,m]);return o(function(){var e=function(e){if(a){var n=w.initX,i=w.mouseDownX,t=w.initY,o=w.mouseDownY,d=e.clientX-i,u=e.clientY-o;r({x:n+d,y:t+u})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[w,a,r]),o(function(){var e=function(){u(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[u]),h}(I,b,O),L=function(e,n,r,d,a){var u=i(!1),s=u[0],w=u[1],m=i({initX:0,initY:0,initWidth:0,initHeight:0,mouseDownX:0,mouseDownY:0}),h=m[0],l=m[1],c=t(function(i){i.preventDefault(),l({initX:e,initY:n,initWidth:r,initHeight:d,mouseDownX:i.clientX,mouseDownY:i.clientY}),w(!0)},[r,d,w,l,e,n]);return o(function(){var e=function(e){if(s){var n=h.initX,i=h.initY,t=h.initWidth,o=h.mouseDownX,r=h.initHeight,d=h.mouseDownY,u=e.clientX-o,w=e.clientY-d;return a({x:n,y:i,width:t+u,height:r+w})}};return window.addEventListener("mousemove",e,{passive:!0}),function(){return window.removeEventListener("mousemove",e)}},[h,s,a]),o(function(){var e=function(){w(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}},[w]),c}(I,b,S,D,Z),j=a(function(){return n("div",{className:"ant-design-draggable-modal-title",onMouseDown:E,onClick:Y},f)},[E,Y,f]);return n(m,h({wrapClassName:"ant-design-draggable-modal",style:X,width:S,destroyOnClose:!0,mask:!1,maskClosable:!1,zIndex:y,title:j,visible:w},x),l,n(c,{onMouseDown:L}))});f.displayName="DraggableModalInner";var x=function(){return{width:window.innerWidth||0,height:window.innerHeight||0}},g=function(e,n,i){return Math.max(e,Math.min(n,i))},p={maxZIndex:0,windowSize:x(),modals:{}},z={x:0,y:0,width:800,height:800,zIndex:0,visible:!1},y=function(e,n){return e.modals[n]||z},I=function(e,n){return y(e,n).zIndex===e.maxZIndex?e.maxZIndex:e.maxZIndex+1},b=function(e,n,i,t,o,r){var d=n-r;return{x:g(0,e-o,i),y:g(0,d,t)}},S=function(e,n,i,t,o,r){var d=n-t;return{width:g(200,e-i,o),height:g(200,d,r)}},D=function(e,n){var i,t,o,r,d,a,u,s;switch(n.type){case"resize":var w=S(e.windowSize.width,e.windowSize.height,n.x,n.y,n.width,n.height);return h({},e,{maxZIndex:I(e,n.id),modals:h({},e.modals,(i={},i[n.id]=h({},e.modals[n.id],w,{zIndex:I(e,n.id)}),i))});case"drag":return h({},e,{maxZIndex:I(e,n.id),modals:h({},e.modals,(t={},t[n.id]=h({},e.modals[n.id],b(e.windowSize.width,e.windowSize.height,n.x,n.y,e.modals[n.id].width,e.modals[n.id].height),{zIndex:I(e,n.id)}),t))});case"show":var m=e.modals[n.id],l=e.windowSize.width/2-m.width/2,c=e.windowSize.height/2-m.height/2,v=b(e.windowSize.width,e.windowSize.height,l,c,m.width,m.height),f=S(e.windowSize.width,e.windowSize.height,v.x,v.y,m.width,m.height);return h({},e,{maxZIndex:e.maxZIndex+1,modals:h({},e.modals,(o={},o[n.id]=h({},m,v,f,{zIndex:e.maxZIndex+1,visible:!0}),o))});case"focus":var x=e.modals[n.id];return h({},e,{maxZIndex:e.maxZIndex+1,modals:h({},e.modals,(r={},r[n.id]=h({},x,{zIndex:e.maxZIndex+1}),r))});case"hide":var g=e.modals[n.id];return h({},e,{modals:h({},e.modals,(d={},d[n.id]=h({},g,{visible:!1}),d))});case"mount":return h({},e,{maxZIndex:e.maxZIndex+1,modals:h({},e.modals,(a={},a[n.id]=h({},z,{x:e.windowSize.width/2-z.width/2,y:e.windowSize.height/2-z.height/2,zIndex:e.maxZIndex+1}),a))});case"unmount":var p=h({},e.modals);return delete p[n.id],h({},e,{modals:p});case"windowResize":return h({},e,{windowSize:n.size,modals:(u=e.modals,s=function(n){if(!n.visible)return n;var i=b(e.windowSize.width,e.windowSize.height,n.x,n.y,n.width,n.height),t=S(e.windowSize.width,e.windowSize.height,i.x,i.y,n.width,n.height);return h({},n,i,t)},Object.assign.apply(Object,[{}].concat(Object.keys(u).map(function(e){var n;return(n={})[e]=s(u[e]),n}))))});default:throw new Error}},X=function(e){var i=w(),t=u(l);if(!t)throw new Error("No Provider");var o=t.dispatch,r=t.state,d=y(r,i);return n(f,h({id:i,dispatch:o,modalState:d},e))},Y=function(e){var i=e.children,t=s(D,p),r=t[0],d=t[1];return o(function(){if("object"==typeof window){var e=function(){return d({type:"windowResize",size:x()})};return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}},[d]),n(l.Provider,{value:{state:r,dispatch:d}},i)};export{X as DraggableModal,l as DraggableModalContext,Y as DraggableModalProvider};
//# sourceMappingURL=index.es.js.map
